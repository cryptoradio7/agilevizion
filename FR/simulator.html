<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur de Conformit√© - AgileVizion</title>
    <link rel="alternate" hreflang="fr" href="simulator.html" />
    <link rel="alternate" hreflang="en" href="../EN/simulator.html" />
    <link rel="alternate" hreflang="x-default" href="simulator.html" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../css/common.css">
    <!-- Calendly Widget -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { background: #f7fafc; }
        
        /* ===== HERO ===== */
        .hero { background: linear-gradient(135deg, #2980b9 0%, #1a5276 100%); color: white; padding: 50px 20px; text-align: center; }
        .hero h1 { font-size: 2em; margin-bottom: 12px; font-weight: 700; max-width: 800px; margin-left: auto; margin-right: auto; }
        .hero p { font-size: 1.1em; opacity: 0.95; max-width: 600px; margin: 0 auto; }
        
        /* ===== CONTAINER ===== */
        .container { max-width: 850px; margin: 0 auto; padding: 30px 20px; }
        
        /* ===== SECTION CARDS ===== */
        .section-card { background: white; border-radius: 10px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        .section-title { font-size: 1.15em; color: #1a202c; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 3px solid #2980b9; display: flex; align-items: center; gap: 10px; }
        .section-title i { color: #2980b9; }
        
        /* ===== QUESTIONS ===== */
        .question-row { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; flex-wrap: wrap; }
        .question-label { font-weight: 600; color: #2d3748; font-size: 0.9em; min-width: 220px; flex-shrink: 0; }
        .question-label .required { color: #c53030; margin-left: 2px; }
        .question-hint { font-size: 0.8em; color: #718096; font-style: italic; flex: 1; min-width: 120px; }
        .question-select { width: 180px; padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 0.9em; background: white; cursor: pointer; transition: border-color 0.2s; flex-shrink: 0; }
        .question-select:focus { outline: none; border-color: #2980b9; }
        .question-select:hover { border-color: #2980b9; }
        .question-select.error { border-color: #c53030; background: #fef2f2; }
        .question-select.valid { border-color: #27ae60; }
        
        /* ===== VALIDATION MESSAGE ===== */
        .validation-msg { display: none; background: #fef2f2; border: 1px solid #c53030; color: #c53030; padding: 12px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em; }
        .validation-msg.visible { display: flex; align-items: center; gap: 10px; }
        .validation-msg i { font-size: 1.2em; }
        
        /* ===== PROGRESS BAR ===== */
        .progress-container { margin-bottom: 20px; }
        .progress-text { font-size: 0.85em; color: #718096; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .progress-bar { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #2980b9, #27ae60); border-radius: 4px; transition: width 0.3s; }
        
        /* ===== BUTTON ===== */
        .btn-calculate { width: 100%; padding: 16px 30px; background: linear-gradient(135deg, #2980b9 0%, #1a5276 100%); color: white; border: none; border-radius: 8px; font-size: 1.15em; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-calculate:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(41, 128, 185, 0.4); }
        .btn-calculate:disabled { background: #9ca3af; cursor: not-allowed; transform: none; box-shadow: none; }
        
        /* ===== RESULTS ===== */
        .results-section { display: none; }
        .results-section.visible { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .results-summary { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
        .summary-card { text-align: center; padding: 20px 15px; border-radius: 10px; color: white; }
        .summary-card.mandatory { background: linear-gradient(135deg, #c53030, #9b2c2c); }
        .summary-card.recommended { background: linear-gradient(135deg, #2980b9, #1a5276); }
        .summary-number { font-size: 2.5em; font-weight: 700; }
        .summary-label { font-size: 0.9em; opacity: 0.95; }
        
        /* ===== RESULTS CARDS ===== */
        .results-category { margin-bottom: 25px; }
        .results-category h3 { font-size: 1.1em; color: #1a202c; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .results-category h3 i { font-size: 0.9em; }
        .results-category h3.mandatory-title { color: #c53030; }
        .results-category h3.recommended-title { color: #2980b9; }
        
        .norm-card { background: #f8fafc; border-radius: 8px; padding: 15px 18px; margin-bottom: 10px; border-left: 4px solid; }
        .norm-card.mandatory { border-left-color: #c53030; }
        .norm-card.recommended { border-left-color: #2980b9; }
        .norm-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .norm-name { font-weight: 700; font-size: 1.05em; color: #1a202c; }
        .norm-badge { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.75em; font-weight: 600; }
        .norm-badge.mandatory { background: #fde8e8; color: #c53030; }
        .norm-badge.recommended { background: #ebf5fb; color: #2980b9; }
        .norm-why { font-size: 0.9em; color: #4a5568; margin-bottom: 6px; }
        .norm-sanction { font-size: 0.85em; color: #c53030; font-weight: 500; }
        .norm-sanction i { margin-right: 5px; }
        
        .no-results { text-align: center; padding: 30px; color: #718096; }
        .no-results i { font-size: 2em; margin-bottom: 10px; display: block; color: #27ae60; }
        
        /* ===== PDF SECTION ===== */
        .pdf-section { background: #ebf5fb; border: 2px solid #2980b9; border-radius: 10px; padding: 25px; margin-top: 25px; }
        .pdf-section h4 { color: #1a202c; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; font-size: 1.1em; }
        .pdf-section h4 i { color: #2980b9; }
        .pdf-section p { font-size: 0.9em; color: #4a5568; margin-bottom: 15px; }
        .form-row { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .form-input { flex: 1; min-width: 180px; padding: 11px 14px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 0.95em; }
        .form-input:focus { outline: none; border-color: #2980b9; }
        .btn-send { padding: 11px 22px; background: #2980b9; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.95em; white-space: nowrap; transition: background 0.2s; }
        .btn-send:hover { background: #1a5276; }
        .btn-send:disabled { background: #9ca3af; cursor: not-allowed; }
        .success-msg { display: none; color: #166534; margin-top: 12px; font-size: 0.9em; padding: 12px; background: #dcfce7; border-radius: 6px; }
        .success-msg.visible { display: block; }
        .error-msg { display: none; color: #c53030; margin-top: 12px; font-size: 0.9em; padding: 12px; background: #fef2f2; border-radius: 6px; }
        .error-msg.visible { display: block; }
        
        /* ===== CTA SECTION ===== */
        .cta-section { background: linear-gradient(135deg, #2980b9 0%, #1a5276 100%); color: white; padding: 40px 25px; border-radius: 10px; text-align: center; margin-top: 25px; }
        .cta-section h3 { font-size: 1.4em; margin-bottom: 10px; }
        .cta-section p { opacity: 0.95; margin-bottom: 25px; }
        .cta-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .cta-btn { display: inline-flex; align-items: center; gap: 10px; padding: 14px 28px; border-radius: 50px; text-decoration: none; font-weight: 600; transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; border: none; font-size: 1em; }
        .cta-btn.primary { background: white; color: #2980b9; }
        .cta-btn.secondary { background: transparent; border: 2px solid white; color: white; }
        .cta-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.25); }
        
        /* ===== PDF TEMPLATE ===== */
        #pdf-content { padding: 25px; background: white; font-family: 'Segoe UI', sans-serif; }
        #pdf-content h1 { color: #2980b9; font-size: 1.5em; margin-bottom: 15px; }
        #pdf-content .pdf-header { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0; }
        #pdf-content .pdf-footer { margin-top: 25px; padding-top: 15px; border-top: 2px solid #e2e8f0; color: #2980b9; }
        #pdf-content .pdf-norm { padding: 10px; margin: 8px 0; border-left: 3px solid; background: #f8f9fa; }
        #pdf-content .pdf-norm.mandatory { border-color: #c53030; }
        #pdf-content .pdf-norm.recommended { border-color: #2980b9; }
        
        .spinner { display: inline-block; width: 18px; height: 18px; border: 2px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .hero { padding: 35px 15px; }
            .hero h1 { font-size: 1.5em; }
            .hero p { font-size: 1em; }
            .container { padding: 20px 15px; }
            .section-card { padding: 18px; }
            .question-row { flex-direction: column; align-items: flex-start; gap: 6px; }
            .question-label { min-width: auto; }
            .question-hint { min-width: auto; }
            .question-select { width: 100%; }
            .results-summary { grid-template-columns: 1fr; }
            .cta-buttons { flex-direction: column; }
            .cta-btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <!-- ===== HERO ===== -->
    <div class="hero">
        <h1><i class="fa-solid fa-shield-halved"></i> Quelles r√©glementations Cyber s'appliquent √† votre organisation ?</h1>
        <p>R√©pondez √† 17 questions et d√©couvrez vos r√©f√©rentiels de conformit√© obligatoires et recommand√©s.</p>
    </div>

    <!-- ===== MAIN CONTENT ===== -->
    <div class="container">
        
        <!-- PROGRESS BAR -->
        <div class="progress-container">
            <div class="progress-text">
                <span>Progression</span>
                <span id="progress-count">0/17 questions</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
        </div>

        <!-- VALIDATION MESSAGE -->
        <div class="validation-msg" id="validation-msg">
            <i class="fa-solid fa-circle-exclamation"></i>
            <span>Veuillez r√©pondre √† toutes les questions pour obtenir des r√©sultats pr√©cis.</span>
        </div>

        <!-- SECTION 1: INFOS G√âN√âRALES -->
        <div class="section-card">
            <h2 class="section-title"><i class="fa-solid fa-building"></i> Section 1 ‚Äî Informations g√©n√©rales</h2>
            
            <div class="question-row">
                <span class="question-label">Q1. Nombre de salari√©s<span class="required">*</span></span>
                <span class="question-hint">CDI + CDD (hors int√©rim)</span>
                <select class="question-select" id="q1" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="<50">< 50</option>
                    <option value="50-249">50 - 249</option>
                    <option value="250-499">250 - 499</option>
                    <option value="500+">500+</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q2. Chiffre d'affaires annuel<span class="required">*</span></span>
                <span class="question-hint">CA net dernier exercice</span>
                <select class="question-select" id="q2" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="<10M">< 10M‚Ç¨</option>
                    <option value="10-50M">10M‚Ç¨ - 50M‚Ç¨</option>
                    <option value=">50M">> 50M‚Ç¨</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q3. Total du bilan<span class="required">*</span></span>
                <span class="question-hint">Total Actif = Total Passif</span>
                <select class="question-select" id="q3" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="<10M">< 10M‚Ç¨</option>
                    <option value="10-43M">10M‚Ç¨ - 43M‚Ç¨</option>
                    <option value=">43M">> 43M‚Ç¨</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q4. Si√®ge / Zone g√©ographique<span class="required">*</span></span>
                <span class="question-hint">Localisation ou clients UE ?</span>
                <select class="question-select" id="q4" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="EU">Union Europ√©enne</option>
                    <option value="nonEU_clients">Hors UE avec clients UE</option>
                    <option value="nonEU_no">Hors UE, pas de clients UE</option>
                </select>
            </div>
        </div>

        <!-- SECTION 2: SECTEUR -->
        <div class="section-card">
            <h2 class="section-title"><i class="fa-solid fa-industry"></i> Section 2 ‚Äî Secteur d'activit√©</h2>
            
            <div class="question-row">
                <span class="question-label">Q5. Secteur principal<span class="required">*</span></span>
                <span class="question-hint">Activit√© g√©n√©rant le plus de CA</span>
                <select class="question-select" id="q5" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <optgroup label="Annexe I - Hautement critiques">
                        <option value="energy">√ânergie</option>
                        <option value="transport">Transport</option>
                        <option value="banking">Banque / Finance</option>
                        <option value="health">Sant√©</option>
                        <option value="water">Eau / Environnement</option>
                        <option value="telecom">T√©l√©com / Cloud / Datacenter</option>
                        <option value="msp">MSP / MSSP / Services IT</option>
                        <option value="public">Administration publique</option>
                        <option value="space">Spatial</option>
                    </optgroup>
                    <optgroup label="Annexe II - Critiques">
                        <option value="postal">Services postaux</option>
                        <option value="waste">Gestion des d√©chets</option>
                        <option value="chemistry">Chimie</option>
                        <option value="food">Agroalimentaire</option>
                        <option value="manufacturing">Industrie manufacturi√®re</option>
                        <option value="digital">Fournisseur num√©rique (marketplace, social)</option>
                        <option value="research">Recherche</option>
                    </optgroup>
                    <optgroup label="Autres">
                        <option value="insurance">Assurance / Mutuelle</option>
                        <option value="retail">Commerce / E-commerce</option>
                        <option value="services">Services aux entreprises</option>
                        <option value="other">Autre</option>
                    </optgroup>
                </select>
            </div>
        </div>

        <!-- SECTION 3: DONN√âES -->
        <div class="section-card">
            <h2 class="section-title"><i class="fa-solid fa-database"></i> Section 3 ‚Äî Donn√©es & Traitements</h2>
            
            <div class="question-row">
                <span class="question-label">Q6. Traitez-vous des donn√©es personnelles ?<span class="required">*</span></span>
                <span class="question-hint">Nom, email, t√©l√©phone, IP, cookies, RH...</span>
                <select class="question-select" id="q6" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q7. Traitez-vous des donn√©es de sant√© ?<span class="required">*</span></span>
                <span class="question-hint">Dossiers patients, donn√©es m√©dicales...</span>
                <select class="question-select" id="q7" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q8. Traitez-vous des donn√©es de cartes (PAN) ?<span class="required">*</span></span>
                <span class="question-hint">Non si Stripe/PayPal masque le PAN</span>
                <select class="question-select" id="q8" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui - nous voyons/stockons les num√©ros</option>
                    <option value="no">Non - nous utilisons Stripe/PayPal/etc.</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q9. Volume de transactions carte/an ?<span class="required">*</span></span>
                <span class="question-hint">Si vous traitez des cartes</span>
                <select class="question-select" id="q9" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="na">N/A - pas de traitement carte</option>
                    <option value="<20k">< 20K (Niveau 4 - SAQ)</option>
                    <option value="20k-1m">20K - 1M (Niveau 3 - SAQ)</option>
                    <option value="1m-6m">1M - 6M (Niveau 2 - SAQ + ASV)</option>
                    <option value=">6m">> 6M (Niveau 1 - Audit QSA)</option>
                </select>
            </div>
        </div>

        <!-- SECTION 4: R√âGLEMENTATIONS -->
        <div class="section-card">
            <h2 class="section-title"><i class="fa-solid fa-gavel"></i> Section 4 ‚Äî R√©glementations & Exigences clients</h2>
            
            <div class="question-row">
                <span class="question-label">Q10. R√©gul√© par l'AMF/ACPR ?<span class="required">*</span></span>
                <span class="question-hint">Agr√©ment bancaire/assurance, SGP, OPCVM...</span>
                <select class="question-select" id="q10" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui - nous avons un agr√©ment financier</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q11. Prestataire TIC pour entit√©s financi√®res ?<span class="required">*</span></span>
                <span class="question-hint">Sous-traitant IT pour banques/assureurs</span>
                <select class="question-select" id="q11" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui - nous fournissons de l'IT √† des entit√©s r√©gul√©es</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q12. Fournissez-vous des services IT/Cloud ?<span class="required">*</span></span>
                <span class="question-hint">MSP, SaaS, h√©bergement, conseil...</span>
                <select class="question-select" id="q12" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q13. H√©bergez-vous des donn√©es de sant√© pour des tiers ?<span class="required">*</span></span>
                <span class="question-hint">Pour des clients (h√¥pitaux, cliniques...)</span>
                <select class="question-select" id="q13" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui - nous h√©bergeons des donn√©es sant√© clients</option>
                    <option value="no">Non (ou uniquement nos propres donn√©es)</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q14. Travaillez-vous avec le DoD US ?<span class="required">*</span></span>
                <span class="question-hint">Contrats D√©partement de la D√©fense US</span>
                <select class="question-select" id="q14" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q15. Vos clients exigent-ils ISO 27001 ?<span class="required">*</span></span>
                <span class="question-hint">Appels d'offres, grands comptes, contrats</span>
                <select class="question-select" id="q15" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui - exigence contractuelle</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q16. Vos clients exigent-ils SOC 2 ?<span class="required">*</span></span>
                <span class="question-hint">Clients US, Fortune 500, SaaS B2B</span>
                <select class="question-select" id="q16" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui - clients US l'exigent</option>
                    <option value="no">Non</option>
                </select>
            </div>
            
            <div class="question-row">
                <span class="question-label">Q17. Avez-vous des activit√©s critiques √† prot√©ger ?<span class="required">*</span></span>
                <span class="question-hint">Exigences de continuit√© d'activit√©</span>
                <select class="question-select" id="q17" onchange="updateProgress()">
                    <option value="">‚Äî S√©lectionner ‚Äî</option>
                    <option value="yes">Oui - nous avons des op√©rations critiques</option>
                    <option value="no">Non</option>
                </select>
            </div>
        </div>

        <!-- BUTTON -->
        <button class="btn-calculate" onclick="calculate()" id="btn-calc">
            <i class="fa-solid fa-magnifying-glass-chart"></i>
            Analyser mes exigences de conformit√©
        </button>

        <!-- ===== RESULTS ===== -->
        <div class="results-section" id="results">
            <div class="section-card">
                <h2 class="section-title"><i class="fa-solid fa-clipboard-check"></i> Vos r√©f√©rentiels applicables</h2>
                
                <div class="results-summary">
                    <div class="summary-card mandatory">
                        <div class="summary-number" id="cnt-mand">0</div>
                        <div class="summary-label">Obligatoires / Requis</div>
                    </div>
                    <div class="summary-card recommended">
                        <div class="summary-number" id="cnt-rec">0</div>
                        <div class="summary-label">Recommand√©s</div>
                    </div>
                </div>
                
                <div id="results-container"></div>
            </div>

            <!-- PDF SECTION -->
            <div class="pdf-section">
                <h4><i class="fa-solid fa-file-pdf"></i> Recevez votre rapport par email</h4>
                <p>Entrez vos coordonn√©es pour recevoir votre √©valuation de conformit√© personnalis√©e en PDF.</p>
                <div class="form-row">
                    <input type="text" class="form-input" id="company" placeholder="Nom de l'entreprise">
                    <input type="email" class="form-input" id="email" placeholder="votre@email.com">
                </div>
                <div class="form-row">
                    <button class="btn-send" onclick="sendReport()" id="btn-send">
                        <i class="fa-solid fa-paper-plane"></i>
                        Envoyer mon rapport
                    </button>
                </div>
                <p class="success-msg" id="success">‚úÖ Rapport t√©l√©charg√© ! Une notification a √©t√© envoy√©e √† AgileVizion.</p>
                <p class="error-msg" id="error">‚ùå Erreur. Veuillez r√©essayer.</p>
            </div>

            <!-- CTA -->
            <div class="cta-section">
                <h3>Besoin d'aide pour vous mettre en conformit√© ?</h3>
                <p>Discutons de votre situation et construisons ensemble une feuille de route ‚Äî 30 min, gratuit, sans engagement.</p>
                <div class="cta-buttons">
                    <a href="" onclick="Calendly.initPopupWidget({url: 'https://calendly.com/emmanuel-genesteix-agilevizion/diagnostic-agilevizion'});return false;" class="cta-btn primary">
                        <i class="fa-solid fa-calendar-check"></i>
                        R√©server un cr√©neau
                    </a>
                    <a href="mailto:emmanuel.genesteix@agilevizion.com" class="cta-btn secondary">
                        <i class="fa-solid fa-envelope"></i>
                        Envoyer un email
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <!-- ===== PDF TEMPLATE (hidden) ===== -->
    <div style="position:absolute;left:-9999px;">
        <div id="pdf-content">
            <h1>üéØ √âvaluation Conformit√© Cyber ‚Äî AgileVizion</h1>
            <div class="pdf-header">
                <p><strong>Entreprise :</strong> <span id="pdf-company"></span></p>
                <p><strong>Email :</strong> <span id="pdf-email"></span></p>
                <p><strong>Date :</strong> <span id="pdf-date"></span></p>
            </div>
            <div id="pdf-results"></div>
            <div class="pdf-footer">
                <p><strong>AgileVizion</strong> ‚Äî Conseil GRC & Cybers√©curit√©</p>
                <p>üìß emmanuel.genesteix@agilevizion.com | üåê www.agilevizion.com</p>
                <p style="margin-top:10px;">Besoin d'aide ? R√©servez un appel gratuit : calendly.com/emmanuel-genesteix-agilevizion</p>
            </div>
        </div>
    </div>

    <script src="../js/components.js"></script>
    <script>
        // ========== NORMS CONFIG ==========
        const NORMS = {
            rgpd: { 
                name: "RGPD", 
                fullName: "R√®glement G√©n√©ral sur la Protection des Donn√©es",
                source: "R√®glement (UE) 2016/679",
                sanctions: "20M‚Ç¨ ou 4% du CA mondial",
                deadline: "En vigueur"
            },
            dora: { 
                name: "DORA", 
                fullName: "Digital Operational Resilience Act",
                source: "R√®glement (UE) 2022/2554",
                sanctions: "Retrait d'agr√©ment + sanctions financi√®res",
                deadline: "17 janvier 2025"
            },
            nis2: { 
                name: "NIS 2", 
                fullName: "Directive sur la s√©curit√© des r√©seaux et de l'information",
                source: "Directive (UE) 2022/2555",
                sanctions: "10M‚Ç¨/2% (EE) ou 7M‚Ç¨/1,4% (EI)",
                deadline: "17 octobre 2024"
            },
            pcidss: { 
                name: "PCI-DSS", 
                fullName: "Payment Card Industry Data Security Standard",
                source: "PCI-DSS v4.0 (PCI SSC)",
                sanctions: "Amendes r√©seaux + perte traitement cartes",
                deadline: "En vigueur (v4.0)"
            },
            hds: { 
                name: "HDS", 
                fullName: "H√©bergeur de Donn√©es de Sant√©",
                source: "Code de la Sant√© Publique",
                sanctions: "Sanctions p√©nales + amendes CNIL",
                deadline: "En vigueur"
            },
            iso27001: { 
                name: "ISO 27001", 
                fullName: "Syst√®me de Management de la S√©curit√© de l'Information",
                source: "ISO/IEC 27001:2022",
                sanctions: "Perte de contrats et d'acc√®s aux march√©s",
                deadline: "Volontaire"
            },
            iso20000: { 
                name: "ISO 20000", 
                fullName: "Syst√®me de Management des Services IT",
                source: "ISO/IEC 20000-1:2018",
                sanctions: "Perte de diff√©renciation commerciale",
                deadline: "Volontaire"
            },
            soc2: { 
                name: "SOC 2", 
                fullName: "Service Organization Control 2",
                source: "AICPA TSP Section 100",
                sanctions: "Perte de clients US/internationaux",
                deadline: "Volontaire"
            },
            iso22301: { 
                name: "ISO 22301", 
                fullName: "Management de la Continuit√© d'Activit√©",
                source: "ISO 22301:2019",
                sanctions: "Risque d'interruption d'activit√©",
                deadline: "Volontaire"
            },
            cmmc: { 
                name: "CMMC", 
                fullName: "Cybersecurity Maturity Model Certification",
                source: "CMMC 2.0 / 32 CFR Part 170",
                sanctions: "Exclusion des contrats DoD",
                deadline: "Requis pour DoD"
            }
        };

        // NIS 2 sectors
        const NIS2_ANNEX1 = ['energy','transport','banking','health','water','telecom','msp','public','space'];
        const NIS2_ANNEX2 = ['postal','waste','chemistry','food','manufacturing','digital','research'];
        const NIS2_ALL = [...NIS2_ANNEX1, ...NIS2_ANNEX2];
        
        const SENSITIVE_SECTORS = ['banking','insurance','health','telecom','msp'];
        const IT_SECTORS = ['telecom','msp'];

        let results = null;

        // ========== PROGRESS UPDATE ==========
        function updateProgress() {
            let answered = 0;
            for (let i = 1; i <= 17; i++) {
                const val = document.getElementById('q'+i).value;
                const el = document.getElementById('q'+i);
                if (val) {
                    answered++;
                    el.classList.remove('error');
                    el.classList.add('valid');
                } else {
                    el.classList.remove('valid');
                }
            }
            
            const pct = Math.round((answered / 17) * 100);
            document.getElementById('progress-fill').style.width = pct + '%';
            document.getElementById('progress-count').textContent = answered + '/17 questions';
        }

        // ========== VALIDATION ==========
        function validateAll() {
            let valid = true;
            let firstEmpty = null;
            
            for (let i = 1; i <= 17; i++) {
                const el = document.getElementById('q'+i);
                if (!el.value) {
                    el.classList.add('error');
                    valid = false;
                    if (!firstEmpty) firstEmpty = el;
                } else {
                    el.classList.remove('error');
                }
            }
            
            if (!valid) {
                document.getElementById('validation-msg').classList.add('visible');
                firstEmpty.focus();
                firstEmpty.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                document.getElementById('validation-msg').classList.remove('visible');
            }
            
            return valid;
        }

        // ========== CALCULATION ==========
        function calculate() {
            if (!validateAll()) return;

            const a = {};
            for (let i = 1; i <= 17; i++) a['q'+i] = document.getElementById('q'+i).value;

            results = {};

            // ===== RGPD =====
            if (a.q6 === 'yes' && (a.q4 === 'EU' || a.q4 === 'nonEU_clients')) {
                results.rgpd = { st: 'mandatory', why: 'Traitement de donn√©es personnelles de r√©sidents UE' };
            }

            // ===== DORA =====
            if (a.q10 === 'yes') {
                results.dora = { st: 'mandatory', why: 'Entit√© financi√®re r√©gul√©e (agr√©ment AMF/ACPR)' };
            } else if (a.q11 === 'yes') {
                results.dora = { st: 'mandatory', why: 'Prestataire TIC critique pour entit√©s financi√®res' };
            }

            // ===== NIS 2 =====
            const isNis2Sector = NIS2_ALL.includes(a.q5);
            const isEE = ['250-499','500+'].includes(a.q1) || a.q2 === '>50M' || a.q3 === '>43M';
            const isEI = ['50-249'].includes(a.q1) || a.q2 === '10-50M' || a.q3 === '10-43M';
            const isEU = a.q4 === 'EU' || a.q4 === 'nonEU_clients';
            
            if (isNis2Sector && (isEE || isEI) && isEU) {
                const entityType = isEE ? 'Entit√© Essentielle' : 'Entit√© Importante';
                results.nis2 = { st: 'mandatory', why: `Secteur critique + Seuil de taille atteint (${entityType}) + UE` };
            }

            // ===== PCI-DSS =====
            if (a.q8 === 'yes') {
                let level = '';
                if (a.q9 === '>6m') level = ' (Niveau 1 - Audit QSA requis)';
                else if (a.q9 === '1m-6m') level = ' (Niveau 2 - SAQ + scan ASV)';
                else if (a.q9 === '20k-1m') level = ' (Niveau 3 - SAQ)';
                else if (a.q9 === '<20k') level = ' (Niveau 4 - SAQ simplifi√©)';
                results.pcidss = { st: 'mandatory', why: 'Traitement/stockage de donn√©es cartes (PAN)' + level };
            }

            // ===== HDS =====
            if (a.q13 === 'yes') {
                results.hds = { st: 'mandatory', why: 'H√©bergement de donn√©es de sant√© pour des tiers (clients)' };
            }

            // ===== ISO 27001 =====
            if (a.q15 === 'yes') {
                results.iso27001 = { st: 'mandatory', why: 'Exig√© contractuellement par les clients' };
            } else if (SENSITIVE_SECTORS.includes(a.q5) || a.q11 === 'yes') {
                results.iso27001 = { st: 'recommended', why: 'Fortement recommand√© pour secteur sensible / sous-traitant financier' };
            }

            // ===== ISO 20000 =====
            if (a.q12 === 'yes') {
                results.iso20000 = { st: 'recommended', why: 'Fournisseur de services IT/Cloud - diff√©renciation commerciale' };
            }

            // ===== SOC 2 =====
            if (a.q16 === 'yes') {
                results.soc2 = { st: 'mandatory', why: 'Exig√© par les clients US' };
            } else if (a.q12 === 'yes' && IT_SECTORS.includes(a.q5)) {
                results.soc2 = { st: 'recommended', why: 'SaaS/Cloud B2B - souvent demand√© par clients internationaux' };
            }

            // ===== ISO 22301 =====
            if (a.q17 === 'yes') {
                results.iso22301 = { st: 'recommended', why: 'Activit√©s critiques identifi√©es - continuit√© essentielle' };
            } else if (['banking','health','energy'].includes(a.q5)) {
                results.iso22301 = { st: 'recommended', why: 'Secteur critique - exigences de continuit√© (DORA/NIS2 incluent PCA)' };
            }

            // ===== CMMC =====
            if (a.q14 === 'yes') {
                results.cmmc = { st: 'mandatory', why: 'Travail avec le D√©partement de la D√©fense US' };
            }

            showResults(results);
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function showResults(r) {
            const mandatory = [];
            const recommended = [];
            
            Object.entries(r).forEach(([k, v]) => {
                const norm = { ...NORMS[k], key: k, ...v };
                if (v.st === 'mandatory') mandatory.push(norm);
                else if (v.st === 'recommended') recommended.push(norm);
            });

            document.getElementById('cnt-mand').textContent = mandatory.length;
            document.getElementById('cnt-rec').textContent = recommended.length;

            let html = '';

            if (mandatory.length > 0) {
                html += `<div class="results-category">
                    <h3 class="mandatory-title"><i class="fa-solid fa-circle-exclamation"></i> R√©f√©rentiels obligatoires / requis</h3>`;
                mandatory.forEach(n => {
                    html += `<div class="norm-card mandatory">
                        <div class="norm-card-header">
                            <span class="norm-name">${n.name} <small style="font-weight:400;color:#718096;">‚Äî ${n.fullName}</small></span>
                            <span class="norm-badge mandatory">OBLIGATOIRE</span>
                        </div>
                        <div class="norm-why"><i class="fa-solid fa-check" style="color:#27ae60;margin-right:5px;"></i> ${n.why}</div>
                        <div class="norm-sanction"><i class="fa-solid fa-triangle-exclamation"></i> Sanctions : ${n.sanctions}</div>
                    </div>`;
                });
                html += `</div>`;
            }

            if (recommended.length > 0) {
                html += `<div class="results-category">
                    <h3 class="recommended-title"><i class="fa-solid fa-thumbs-up"></i> R√©f√©rentiels recommand√©s</h3>`;
                recommended.forEach(n => {
                    html += `<div class="norm-card recommended">
                        <div class="norm-card-header">
                            <span class="norm-name">${n.name} <small style="font-weight:400;color:#718096;">‚Äî ${n.fullName}</small></span>
                            <span class="norm-badge recommended">RECOMMAND√â</span>
                        </div>
                        <div class="norm-why"><i class="fa-solid fa-lightbulb" style="color:#f39c12;margin-right:5px;"></i> ${n.why}</div>
                        <div class="norm-sanction"><i class="fa-solid fa-info-circle"></i> Enjeux : ${n.sanctions}</div>
                    </div>`;
                });
                html += `</div>`;
            }

            if (mandatory.length === 0 && recommended.length === 0) {
                html = `<div class="no-results">
                    <i class="fa-solid fa-circle-check"></i>
                    <p><strong>Bonne nouvelle !</strong> D'apr√®s vos r√©ponses, aucune r√©glementation cyber sp√©cifique ne semble s'appliquer √† votre organisation.</p>
                    <p style="margin-top:10px;">Cependant, les bonnes pratiques de s√©curit√© sont toujours recommand√©es.</p>
                </div>`;
            }

            document.getElementById('results-container').innerHTML = html;
            document.getElementById('results').classList.add('visible');
        }

        // ========== PDF & EMAIL ==========
        async function sendReport() {
            const company = document.getElementById('company').value.trim();
            const email = document.getElementById('email').value.trim();
            
            if (!company) { alert('Veuillez entrer le nom de votre entreprise'); document.getElementById('company').focus(); return; }
            if (!email || !email.includes('@')) { alert('Veuillez entrer un email valide'); document.getElementById('email').focus(); return; }

            const btn = document.getElementById('btn-send');
            const orig = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span>';
            
            document.getElementById('success').classList.remove('visible');
            document.getElementById('error').classList.remove('visible');

            try {
                const mandatory = [];
                const recommended = [];
                Object.entries(results).forEach(([k, v]) => {
                    const norm = { ...NORMS[k], ...v };
                    if (v.st === 'mandatory') mandatory.push(norm);
                    else if (v.st === 'recommended') recommended.push(norm);
                });

                let pdfHtml = '';
                
                if (mandatory.length > 0) {
                    pdfHtml += `<h3 style="color:#c53030;margin-top:20px;">üî¥ R√âF√âRENTIELS OBLIGATOIRES (${mandatory.length})</h3>`;
                    mandatory.forEach(n => {
                        pdfHtml += `<div class="pdf-norm mandatory">
                            <strong>${n.name}</strong> ‚Äî ${n.fullName}<br>
                            <span style="color:#27ae60;">‚úì ${n.why}</span><br>
                            <span style="color:#c53030;">‚ö† Sanctions : ${n.sanctions}</span>
                        </div>`;
                    });
                }
                
                if (recommended.length > 0) {
                    pdfHtml += `<h3 style="color:#2980b9;margin-top:20px;">üîµ R√âF√âRENTIELS RECOMMAND√âS (${recommended.length})</h3>`;
                    recommended.forEach(n => {
                        pdfHtml += `<div class="pdf-norm recommended">
                            <strong>${n.name}</strong> ‚Äî ${n.fullName}<br>
                            <span style="color:#f39c12;">üí° ${n.why}</span><br>
                            <span style="color:#718096;">‚Ñπ Enjeux : ${n.sanctions}</span>
                        </div>`;
                    });
                }

                if (mandatory.length === 0 && recommended.length === 0) {
                    pdfHtml = `<p style="text-align:center;padding:20px;color:#27ae60;"><strong>‚úì Aucune r√©glementation sp√©cifique identifi√©e selon votre profil.</strong></p>`;
                }

                document.getElementById('pdf-company').textContent = company;
                document.getElementById('pdf-email').textContent = email;
                document.getElementById('pdf-date').textContent = new Date().toLocaleDateString('fr-FR');
                document.getElementById('pdf-results').innerHTML = pdfHtml;

                const el = document.getElementById('pdf-content');
                el.style.display = 'block';

                await html2pdf().set({
                    margin: 10,
                    filename: `AgileVizion_Conformite_${company.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`,
                    image: { type: 'jpeg', quality: 0.95 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                }).from(el).save();

                el.style.display = 'none';

                const summary = [
                    ...mandatory.map(n => `üî¥ ${n.name}: ${n.why}`),
                    ...recommended.map(n => `üîµ ${n.name}: ${n.why}`)
                ].join('\n');

                const mailSubject = encodeURIComponent(`üéØ Nouveau Lead Simulateur: ${company}`);
                const mailBody = encodeURIComponent(
`Nouveau lead depuis le Simulateur Conformit√© Cyber

üìß Email: ${email}
üè¢ Entreprise: ${company}
üìÖ Date: ${new Date().toLocaleString('fr-FR')}

üìä R√âSULTATS:
${summary || 'Aucun r√©f√©rentiel identifi√©'}

---
Obligatoires: ${mandatory.length} | Recommand√©s: ${recommended.length}
`);
                
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = `mailto:emmanuel.genesteix@agilevizion.com?subject=${mailSubject}&body=${mailBody}`;
                document.body.appendChild(iframe);
                setTimeout(() => document.body.removeChild(iframe), 2000);

                document.getElementById('success').classList.add('visible');

            } catch (e) {
                console.error('Erreur:', e);
                document.getElementById('error').classList.add('visible');
            } finally {
                btn.disabled = false;
                btn.innerHTML = orig;
            }
        }

        updateProgress();
    </script>
</body>
</html>

